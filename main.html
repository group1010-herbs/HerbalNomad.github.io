<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kavutiri NDVI Interactive Visualization</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#94a3b8;--accent:#06b6d4}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;color:#e6eef8;background:linear-gradient(180deg,#071122 0%, #0b1630 100%);}    
    .container{max-width:1200px;margin:24px auto;padding:18px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:14px;flex-wrap:wrap;justify-content:space-between}
    h1{font-size:22px;margin:0}
    .card{background:var(--card);padding:12px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    canvas{border-radius:10px;padding:8px;background:rgba(255,255,255,0.02)}
    #map{height:350px;border-radius:10px;margin-top:12px}
    .small{font-size:12px;color:var(--muted)}
    footer{text-align:center;margin-top:18px;font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Kavutiri NDVI Visualization</h1>
        <div class="small">Automatically loaded from JSON (GitHub-ready deployment)</div>
      </div>
    </header>

    <div class="card">
      <canvas id="ndviChart" height="220"></canvas>
    </div>

    <div class="card">
      <div id="map"></div>
    </div>

    <footer>© 2025 Rustic Garden Kavutiri | Built for GitHub Pages | Powered by Chart.js + Leaflet</footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
  async function loadData() {
    try {
      const response = await fetch('ndvi_data.json');
      const json = await response.json();
      return json;
    } catch (err) {
      console.error('Error loading NDVI data:', err);
      return null;
    }
  }

  function createChart(ctx, data) {
    const dates = data.map(d => new Date(d.date));
    const ndvi = data.map(d => d.ndvi);

    return new Chart(ctx, {
      type: 'line',
      data: {
        labels: dates,
        datasets: [{
          label: 'NDVI',
          data: ndvi,
          borderColor: 'rgba(6,182,212,0.9)',
          backgroundColor: 'rgba(6,182,212,0.2)',
          fill: true,
          tension: 0.15
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: {
          x: { type: 'time', time: { unit: 'month' } },
          y: { min: -0.5, max: 1 }
        }
      }
    });
  }

  function createMap(records) {
    const map = L.map('map').setView([-0.5, 37.9], 8);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    records.forEach(rec => {
      if(rec.lat && rec.lon) {
        L.circleMarker([rec.lat, rec.lon], {
          radius: 4,
          fillColor: '#06b6d4',
          color: '#06b6d4',
          opacity: 0.9,
          fillOpacity: 0.6
        }).bindPopup(`<b>${rec.date}</b><br>NDVI: ${rec.ndvi}`).addTo(map);
      }
    });
  }

  (async () => {
    const json = await loadData();
    if(!json || !json.records) {
      document.body.innerHTML += '<p style="text-align:center;color:#f87171;">Error: ndvi_data.json not found or invalid.</p>';
      return;
    }

    const ctx = document.getElementById('ndviChart');
    createChart(ctx, json.records);
    createMap(json.records);
  })();
  </script>
</body>
</html>
